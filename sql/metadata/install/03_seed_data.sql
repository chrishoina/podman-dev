-- NOTE: This script is not intended to be used directly but through
--       install_pdb.sql

SET DEFINE '^'
SET ESCAPE OFF
SET ESCAPE '\'
SET VERIFY OFF
SET ECHO OFF

PROMPT INFO: Inserting Live SQL METADATA Seed Data...

WHENEVER SQLERROR EXIT 1

DECLARE
    L_RESULT NUMBER;
BEGIN
    SELECT
        1
    INTO
        L_RESULT
    FROM
        DUAL
    WHERE
        -- NOTE: Check if we're on an actual PDB
        SYS_CONTEXT( 'USERENV', 'CON_NAME' ) NOT IN ( 'CDB$ROOT', 'PDB$SEED' );
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RAISE_APPLICATION_ERROR( -20000, 'This script must be executed in a PDB' );
END;
/

INSERT INTO
    ROLES (
        ID,
        NAME,
        SEQUENCE
    )
SELECT 1 AS ID, 'BASIC' AS NAME, 10 AS SEQUENCE FROM DUAL
UNION ALL SELECT 2, 'PUBLISHER', 20 FROM DUAL
UNION ALL SELECT 3, 'ADMINISTRATOR', 30 FROM DUAL
UNION ALL SELECT 0, 'INTERNAL', 0 FROM DUAL;

--This user is needed to track queries executed by anonymous users
INSERT INTO USERS (
    EMAIL,
    DISPLAY_NAME,
    ROLE_ID
) VALUES (
    'ANONYMOUS',
    'ANONYMOUS',
    0
);
COMMIT;
ALTER TABLE ROLES MODIFY ID GENERATED BY DEFAULT ON NULL AS IDENTITY ( START WITH LIMIT VALUE ) NOT NULL;

PROMPT INFO: Live SQL METADATA Seed Data Inserted
